Parameters:
  name: Pythia8Pass4Track
  build: mdc2.8
  comment: This is a test job definition
  macro: Fun4All_G4_Trkr.C
  flavor: Charm  
  nEvents: 1
  maxAttempt: 3

InputDataSets:
  - name: Pythia8Pass3Track/outDS
    comment: Charm events plus minbias pileup
    match: Pythia8Pass3Track.outDS.tar
    nFilesPerJob: 1

OutputDataSets:
  - name: Pythia8Pass4Track/outDS
    comment: Pythia8 events
    filelist:
       - "required:Pythia8Pass4Track.outDS.tar"

Resources:
  - file: ../MDC2/submit/HF_pp200_signal/pass4trk/rundir/*

JobCommands: |-
  echo START ${name} `date` 

  # Initialize sPHENIX software environment
  source /opt/sphenix/core/bin/sphenix_setup.sh -n ${build}

  # Input file
  mcin=${IN1[0]}
  
  echo ARGV:       $@       
  echo inputs:     ${IN1[@]}  

  tar xvf ${IN1[@]}

  # arguments 
  # arguments                                                                                                                                                                                                
  # $1: number of events                                                                                                                                                                                     
  # $2: track g4hits input file                                                                                                                                                                              
  # $3: truth g4hits input file                                                                                                                                                                              
  # $4: output dir                                                                                                                                                                                           
  # $5: quark filter                                                                                                                                                                                         
  # $6: run number                                                                                                                                                                                           
  # $7: sequence  

  # DST_BBC_G4HIT_pythia8_Charm_3MHz-0000000001-00001.root
  # DST_CALO_G4HIT_pythia8_Charm_3MHz-0000000001-00001.root
  # DST_TRKR_G4HIT_pythia8_Charm_3MHz-0000000001-00001.root
  # DST_TRUTH_G4HIT_pythia8_Charm_3MHz-0000000001-00001.root
  # DST_VERTEX_pythia8_Charm_3MHz-0000000001-00001.root
  # DST_TRKR_HIT

  dst_track=`ls DST_TRKR_HIT*.root`
  dst_truth=`ls DST_TRUTH*.root`
  outfile=dst_pass4track_output.root

  #root.exe -q -b  Fun4All_G4_Pass4Trk.C\($1,\"$2\",\"$3\",\"\",\"\",0,\"$4\",\"$5\"\)
  echo   root.exe -q -b  Fun4All_G4_Pass4Trk.C\($1,\"${dst_track}\",\"${dst_truth}\",\"\",\"\",0,\".\",\"${flavor}\"\)
  root.exe -q -b  ${macro}\($1,\"${dst_track}\",\"${dst_truth}\",\"\",\"\",0,\".\",\"${flavor}\"\)

  # NOTE: This packs all input files as well...
  touch meh.root
  tar cvf Pythia8Pass4Track.outDS.tar *.root 
  ls 

  echo END   ${name} `date` 

  cp _${name}.log /sphenix/u/sphnxpro/shrek/${name}-${uniqueId}.log